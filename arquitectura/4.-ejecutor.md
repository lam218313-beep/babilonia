Documento de Arquitectura de SoftwareMódulo 04: El Ejecutor (The Executor)Versión: 1.0Patrón de Diseño: Chain of Responsibility / ReAct Agent (Reasoning + Acting)
Función Principal: Generación de contenido, Cálculos técnicos y Rellenado de plantillas.
1. Visión General
El Ejecutor es el agente operativo del sistema. A diferencia del Orquestador (que piensa en "Proyectos") o el Modulador (que piensa en "Formatos"), el Ejecutor piensa en Tareas Atómicas.Su principio rector es la Linealidad Causal: No intenta adivinar el futuro. Se concentra exclusivamente en resolver la tarea N utilizando los inputs de la tarea N−1 y las restricciones proporcionadas por el Modulador.
2. Componentes Principales
2.1. Decodificador de Tareas (Task Decoder)Recibe el "Paquete de Ejecución" del Modulador. Su trabajo es entender qué se le pide antes de empezar.Input: Payload que contiene: {Instrucción, Plantilla Vacía, Normas Filtradas, Contexto del Proyecto}.Descomposición Jerárquica (Hijos/Nietos):Si la tarea es compleja (ej. "Diseñar Escalera"), el Decodificador la rompe en una Micro-Secuencia Lineal interna:Paso Hijo 1: Calcular paso y contrapaso (Ley de Blondel).Paso Hijo 2: Determinar ancho según aforo.Paso Hijo 3: Redactar especificación de baranda.Nota: Esto respeta tu regla de "nunca paralelos". El Ejecutor no pasa al Hijo 2 sin terminar el Hijo 1.2.2. Motor de Razonamiento (The Reasoning Engine)Es el núcleo de IA generativa (Backend LLM).Modo de Operación: Chain-of-Thought (Cadena de Pensamiento):Antes de llenar la plantilla, el Ejecutor genera un "borrador mental" (scratchpad).Ejemplo: "Necesito calcular el acero. La norma dice cuantía mínima 0.002. El área es 20x20. Entonces 20x20x0.002 = 0.8cm2. Ok, usaré 4 varillas de 3/8".Consultas "Just-in-Time":Si durante el razonamiento le falta un dato (ej. "¿Cuánto pesa el concreto ligero?"), hace una micro-consulta rápida al Motor 1 (Data Core) para desbloquearse, sin molestar al Orquestador.2.3. Sintetizador de Salida (Output Synthesizer)Es el encargado de volcar el razonamiento en la Plantilla Rígida del Modulador.Mapeo: Transfiere los resultados de sus cálculos a los campos del JSON (Pydantic) o los párrafos de la plantilla Jinja2.Sanitización: Asegura que no haya texto explicativo ("Aquí tienes el resultado...") dentro del campo de datos. Solo el dato puro.3. Flujo de Datos (Data Flow) - El Ciclo de Vida de una Tarea Imaginemos la tarea: "Predimensionamiento de Viga Peraltada".Recepción: Recibe el paquete del Modulador con la plantilla JSON {peralte: float, base: float} y la norma "L/12 para vigas continuas".Micro-Secuencia (Ejecución):Acción 1 (Leer): Identifica la luz libre (input previo: 6 metros).Acción 2 (Calcular): Aplica fórmula norma: H=L/12→6/12=0.50m.Acción 3 (Verificar): Revisa si hay restricciones de altura libre. (Si la altura libre es 2.40m y la viga baja a 2.30m, todo OK).Rellenado: Escribe 0.50 en el campo peralte y 0.25 en base.Auto-Reflexión (Self-Correction):Pregunta interna: "¿He cumplido con el formato JSON estricto?"Respuesta: Sí.Entrega: Envía el JSON al Orquestador para su aprobación.4. Gestión de Errores (The Loop)Si el Orquestador rechaza el trabajo (ej. "La viga choca con la ventana"), el Ejecutor recibe el feedback como una nueva restricción.Re-intento: El Ejecutor toma el estado anterior, añade la restricción "Viga < 0.45m" y vuelve a ejecutar la micro-secuencia, quizás cambiando el ancho para compensar el peralte.5. Stack Tecnológico SugeridoOrquestación de la Cadena: LangChain (usando SequentialChain). Es perfecto para definir la secuencia lineal de pensamientos (Input -> Pensar -> Calcular -> Formatear).Code Execution (Opcional): Para cálculos matemáticos complejos, el Ejecutor no debería usar el LLM (que es malo sumando). Debería tener acceso a una herramienta Python REPL (calculadora de código) para ejecutar 0.002 * 20 * 20 y obtener el número exacto.Modelo LLM: Puede ser un modelo ligeramente más pequeño y rápido que el Orquestador, como Gemini 1.5 Flash o GPT-4o mini, ya que su tarea está muy acotada y guiada por plantillas.Observación sobre "Hijos, Nietos y Bisnietos"Tu estructura jerárquica se maneja aquí mediante Recursividad.Si el Ejecutor se da cuenta de que una tarea es demasiado grande, puede solicitar al Orquestador que la divida, o (preferiblemente) manejarla internamente como una lista de pasos secuenciales (To-Do List interna) que va tachando uno a uno.